<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8" />
	<title>Quáº£n lÃ½ cÃ¢u há»i tráº¯c nghiá»‡m</title>
	<link rel="stylesheet" href="style.css" />
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6">
	</script>
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
	</script>
</head>

<body>
	<h1>Nháº­p cÃ¢u há»i tráº¯c nghiá»‡m</h1>

	<form action="save_question.php" method="POST" enctype="multipart/form-data" id="questionForm">
		<div class="container">
			<div class="left-column">
				<label for="question">CÃ¢u há»i:</label>
				<textarea id="question" name="question" rows="3" oninput="previewMath()"></textarea>

				<label for="answer1">ÄÃ¡p Ã¡n A:</label>
				<input type="text" name="answer1" required />

				<label for="answer2">ÄÃ¡p Ã¡n B:</label>
				<input type="text" name="answer2" required />

				<label for="answer3">ÄÃ¡p Ã¡n C:</label>
				<input type="text" name="answer3" />

				<label for="answer4">ÄÃ¡p Ã¡n D:</label>
				<input type="text" name="answer4" />

				<label for="correct_answer">ÄÃ¡p Ã¡n Ä‘Ãºng:</label>
				<select name="correct_answer" id="correct_answer" required>
					<option value="">-- Chá»n Ä‘Ã¡p Ã¡n Ä‘Ãºng --</option>
					<option value="answer1">A</option>
					<option value="answer2">B</option>
					<option value="answer3">C</option>
					<option value="answer4">D</option>
				</select>

				<label for="image">áº¢nh minh há»a (náº¿u cÃ³):</label>
				<input type="file" name="image" id="image" accept="image/*" />
				<img id="imagePreview" src="#" alt="Xem trÆ°á»›c áº£nh" />
			</div>


			<div class="right-column">
				<button type="submit">ğŸ’¾ LÆ°u</button>
				<button type="button">â• ThÃªm má»›i</button>
				<button type="button">ğŸ—‘ï¸ XoÃ¡</button>
				<button type="button">âœï¸ Sá»­a</button>
				<button type="button">ğŸ” TÃ¬m kiáº¿m</button>
				<button type="button" onclick="syncTable()">ğŸ”„ Hiá»ƒn thá»‹</button>
			</div>
		</div>
	</form>

	<div id="preview"></div>

	<!-- Danh sÃ¡ch cÃ¢u há»i -->
	<h2>CÃ¡c cÃ¢u há»i Ä‘Ã£ lÆ°u</h2>
	<div style="max-width: 1000px; max-height: 400px; overflow-y: auto; border: 1px solid #ccc; border-radius: 6px;">
		<iframe id="questionTable" src="get_question.php" style="width: 100%; height: 100%; border: none;"></iframe>
	</div>

	<!-- Script xá»­ lÃ½ MathJax & Xem áº£nh -->
	<script>
		const questionInput = document.getElementById('question');
		const preview = document.getElementById('preview');

		questionInput.addEventListener('input', () => {
			preview.innerHTML = questionInput.value;
			MathJax.typesetPromise([preview]);
		});

		const imageInput = document.getElementById('image');
		const imagePreview = document.getElementById('imagePreview');

		imageInput.addEventListener('change', function () {
			if (this.files && this.files[0]) {
				const reader = new FileReader();
				reader.onload = function (e) {
					imagePreview.src = e.target.result;
					imagePreview.style.display = 'block';
				};
				reader.readAsDataURL(this.files[0]);
			} else {
				imagePreview.style.display = 'none';
				imagePreview.src = '';
			}
		});
	</script>
	<script>
		const form = document.getElementById('questionForm');
		const iframe = document.getElementById('questionTable');

		form.addEventListener('submit', function (e) {
			e.preventDefault(); // NgÄƒn submit truyá»n thá»‘ng

			const formData = new FormData(form);

			fetch('save_question.php', {
				method: 'POST',
				body: formData
			})
				.then(response => response.text())
				.then(result => {
					alert(result); // Hiá»ƒn thá»‹ káº¿t quáº£

					// Reset form
					form.reset();
					document.getElementById('imagePreview').style.display = 'none';
					document.getElementById('preview').innerHTML = '';

					// LÃ m má»›i báº£ng
					iframe.contentWindow.location.reload();
				})
				.catch(error => {
					alert('Lá»—i khi gá»­i dá»¯ liá»‡u!');
					console.error('Error:', error);
				});
		});

	</script>
	<script>
		function syncTable() {
			const iframe = document.getElementById('questionTable');
			iframe.contentWindow.location.reload();         // Reload iframe
			iframe.scrollIntoView({ behavior: 'smooth' });  // ÄÆ°a con trá» lÃªn Ä‘áº§u
		}
	</script>

	<script>
		window.addEventListener('message', function (event) {
			const data = event.data;

			if (data && typeof data === 'object') {
				document.getElementById('question').value = data.question || '';
				document.querySelector('[name="answer1"]').value = data.answer1 || '';
				document.querySelector('[name="answer2"]').value = data.answer2 || '';
				document.querySelector('[name="answer3"]').value = data.answer3 || '';
				document.querySelector('[name="answer4"]').value = data.answer4 || '';
				document.querySelector('[name="correct_answer"]').value = data.correct_answer || '';

				// Hiá»ƒn thá»‹ áº£nh náº¿u cÃ³
				const imgPreview = document.getElementById('imagePreview');
				if (data.image) {
					imgPreview.src = data.image;
					imgPreview.style.display = 'block';
				} else {
					imgPreview.style.display = 'none';
				}

				// Hiá»ƒn thá»‹ cÃ´ng thá»©c náº¿u cÃ³
				document.getElementById('preview').innerHTML = data.question || '';
				MathJax.typesetPromise([document.getElementById('preview')]);
			}
		});
	</script>


</body>

</html>